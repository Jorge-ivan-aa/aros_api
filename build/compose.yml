services:
  db_deploy:
    image: mariadb:11.2
    container_name: aros_db_test_deploy
    environment:
      - 'MARIADB_DATABASE=${DB_NAME}'
      - 'MARIADB_ROOT_PASSWORD=${DB_ROOT_PASSWORD}'
    ports:
      - "${DB_PORT}:3306"
    healthcheck:
      test: ["CMD-SHELL", "mariadb-admin ping -h localhost -uroot -p${DB_ROOT_PASSWORD} || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 30s

  api_deploy:
    image: buhoaullador/aros-api:latest
    container_name: aros_api_test_deploy
    environment:
      - 'DB_NAME=${DB_NAME}'
      - 'DB_ROOT_PASSWORD=${DB_ROOT_PASSWORD}'
      - 'DB_PORT=${DB_PORT}'
      - 'DB_HOST=${DB_HOST}'
      - 'LOGGING_LEVEL_APP=${LOGGING_LEVEL_APP}'
      - 'TOKEN_SECRET=${TOKEN_SECRET}'
      - 'ADMIN_DOCUMENT=${ADMIN_DOCUMENT}'
      - 'ADMIN_PASSWORD_HASH=${ADMIN_PASSWORD_HASH}'
      - 'ALLOWED_ORIGINS=${ALLOWED_ORIGINS}'
    ports:
      - "8080:8080"
    depends_on:
      db_deploy:
              condition: service_healthy
